---
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import RoadmapBanner from '../../components/RoadmapBanner.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getRoadmapTopicFiles, RoadmapTopicFileType } from '../../lib/roadmap-topic';

export async function getStaticPaths() {
  const topicPathMapping = await getRoadmapTopicFiles();

  return Object.keys(topicPathMapping).map((topicSlug) => {
    const topicDetails = topicPathMapping[topicSlug];
    const roadmapId = topicDetails.roadmapId;
    const topicId = topicSlug.replace(`/${roadmapId}/`, '');

    return {
      params: {
        topicId,
        roadmapId,
      },
      props: topicDetails,
    };
  });
}

const { topicId } = Astro.params;
const { file, breadcrumbs, roadmapId, roadmap, heading } = Astro.props as RoadmapTopicFileType;
---

<BaseLayout
  title={`${heading} - roadmap.sh`}
  description={`Free resources to learn ${heading} in ${roadmap.briefTitle}. Everything you need to know about ${heading} and how it realtes to ${roadmap.briefTitle}.`}
  noIndex={true}
  permalink={`/${roadmapId}/${topicId}`}
>
  <RoadmapBanner roadmapId={roadmapId} roadmap={roadmap} />
  <Breadcrumbs breadcrumbs={breadcrumbs} roadmapId={roadmapId} />

  <div class='relative py-8 sm:py-12 lg:py-16'>
    <div class='container'>
      <!-- Topic Header -->
      <div class='mb-8 sm:mb-12'>
        <div class='mb-4 flex items-center gap-2'>
          <span class='inline-flex items-center gap-1.5 rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary ring-1 ring-primary/20'>
            <svg class='h-3 w-3' fill='currentColor' viewBox='0 0 20 20'>
              <path fill-rule='evenodd' d='M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z' clip-rule='evenodd'></path>
            </svg>
            {roadmap.briefTitle} Topic
          </span>
        </div>
        <h1 class='text-3xl font-black leading-tight text-white sm:text-4xl lg:text-5xl'>
          {heading}
        </h1>
      </div>

      <!-- Content Card -->
      <article class='topic-content-card'>
        <div class='topic-content-inner'>
          <main id='main-content' class='prose-custom'>
            <file.Content />
          </main>
        </div>
      </article>

      <!-- Footer Navigation -->
      <div class='mt-8 flex flex-wrap items-center justify-between gap-4 rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm sm:mt-12'>
        <div class='flex items-center gap-3'>
          <div class='flex h-10 w-10 items-center justify-center rounded-lg bg-primary/20 text-primary'>
            <svg class='h-5 w-5' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
              <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z'></path>
            </svg>
          </div>
          <div>
            <p class='text-sm font-medium text-white'>More Topics</p>
            <p class='text-xs text-muted'>Explore related content</p>
          </div>
        </div>
        <a
          href={`/${roadmapId}/topics`}
          class='inline-flex items-center gap-2 rounded-lg bg-primary px-5 py-2.5 text-sm font-medium text-white transition-all hover:bg-primary-dark'
        >
          <span>View All Topics</span>
          <svg class='h-4 w-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 7l5 5m0 0l-5 5m5-5H6'></path>
          </svg>
        </a>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  /* Topic Content Card */
  .topic-content-card {
    position: relative;
    border-radius: 24px;
    overflow: hidden;
  }

  .topic-content-inner {
    position: relative;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.05) 0%,
      rgba(255, 255, 255, 0.02) 100%
    );
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
    backdrop-filter: blur(20px) saturate(180%);
    padding: 2rem;
    box-shadow: 
      0 4px 16px rgba(0, 0, 0, 0.3),
      0 0 0 1px rgba(59, 130, 246, 0.05) inset;
  }

  @media (min-width: 640px) {
    .topic-content-inner {
      padding: 3rem;
    }
  }

  /* Custom Prose Styles for Dark Theme */
  .prose-custom {
    color: rgba(255, 255, 255, 0.9);
    max-width: none;
  }

  /* Headings */
  .prose-custom :global(h1) {
    color: #ffffff;
    font-size: 2rem;
    font-weight: 800;
    line-height: 1.2;
    margin-bottom: 1.5rem;
    margin-top: 2rem;
  }

  .prose-custom :global(h1:first-child) {
    margin-top: 0;
  }

  .prose-custom :global(h2) {
    color: #ffffff;
    font-size: 1.5rem;
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 1rem;
    margin-top: 2rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .prose-custom :global(h3) {
    color: #ffffff;
    font-size: 1.25rem;
    font-weight: 600;
    line-height: 1.4;
    margin-bottom: 0.75rem;
    margin-top: 1.5rem;
  }

  .prose-custom :global(h4),
  .prose-custom :global(h5),
  .prose-custom :global(h6) {
    color: rgba(255, 255, 255, 0.95);
    font-weight: 600;
    margin-bottom: 0.5rem;
    margin-top: 1rem;
  }

  /* Paragraphs */
  .prose-custom :global(p) {
    margin-top: 0;
    margin-bottom: 1.25rem;
    line-height: 1.75;
    color: rgba(255, 255, 255, 0.8);
  }

  /* Links */
  .prose-custom :global(a) {
    color: #60a5fa;
    text-decoration: underline;
    text-decoration-color: rgba(96, 165, 250, 0.3);
    text-underline-offset: 2px;
    transition: all 0.2s;
  }

  .prose-custom :global(a:hover) {
    color: #93c5fd;
    text-decoration-color: rgba(147, 197, 253, 0.6);
  }

  /* Lists */
  .prose-custom :global(ul),
  .prose-custom :global(ol) {
    margin-top: 1rem;
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
    color: rgba(255, 255, 255, 0.8);
  }

  .prose-custom :global(li) {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    line-height: 1.75;
  }

  .prose-custom :global(ul > li) {
    padding-left: 0.375rem;
  }

  .prose-custom :global(ul > li::marker) {
    color: #3b82f6;
  }

  .prose-custom :global(ol > li::marker) {
    color: #3b82f6;
    font-weight: 600;
  }

  /* Code */
  .prose-custom :global(code) {
    background: rgba(59, 130, 246, 0.1);
    color: #60a5fa;
    padding: 0.125rem 0.375rem;
    border-radius: 0.375rem;
    font-size: 0.875em;
    font-weight: 500;
    border: 1px solid rgba(59, 130, 246, 0.2);
  }

  .prose-custom :global(pre) {
    background: rgba(15, 20, 32, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.75rem;
    padding: 1.25rem;
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    overflow-x: auto;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

  .prose-custom :global(pre code) {
    background: transparent;
    border: none;
    padding: 0;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.875rem;
    line-height: 1.7;
  }

  /* Blockquotes */
  .prose-custom :global(blockquote) {
    border-left: 4px solid #3b82f6;
    background: rgba(59, 130, 246, 0.05);
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    border-radius: 0 0.5rem 0.5rem 0;
    color: rgba(255, 255, 255, 0.85);
  }

  .prose-custom :global(blockquote p) {
    margin-bottom: 0;
  }

  /* Tables */
  .prose-custom :global(table) {
    width: 100%;
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    border-collapse: collapse;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.75rem;
    overflow: hidden;
  }

  .prose-custom :global(thead) {
    background: rgba(59, 130, 246, 0.1);
  }

  .prose-custom :global(th) {
    padding: 0.75rem 1rem;
    text-align: left;
    font-weight: 600;
    color: #ffffff;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .prose-custom :global(td) {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: rgba(255, 255, 255, 0.8);
  }

  .prose-custom :global(tr:last-child td) {
    border-bottom: none;
  }

  .prose-custom :global(tbody tr:hover) {
    background: rgba(255, 255, 255, 0.02);
  }

  /* Horizontal Rule */
  .prose-custom :global(hr) {
    border: none;
    height: 1px;
    background: linear-gradient(
      to right,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent
    );
    margin: 2rem 0;
  }

  /* Images */
  .prose-custom :global(img) {
    border-radius: 0.75rem;
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* Strong/Bold */
  .prose-custom :global(strong) {
    color: #ffffff;
    font-weight: 600;
  }

  /* Emphasis/Italic */
  .prose-custom :global(em) {
    color: rgba(255, 255, 255, 0.9);
  }
</style>
