---
import Icon from '../AstroIcon.astro';

export interface Props {
  question: string;
  isActive?: boolean;
}

const { question, isActive = false } = Astro.props;
---

<div
  class='faq-item group rounded-2xl border border-white/10 bg-surface/50 backdrop-blur-sm transition-all duration-300 hover:border-primary/30 hover:bg-surface/80 hover:shadow-lg hover:shadow-primary/5'
>
  <button
    faq-question
    class='flex w-full flex-row items-center justify-between gap-4 p-4 text-left sm:p-6'
  >
    <span class='text-base font-semibold text-white transition-colors group-hover:text-primary sm:text-lg'
      >{question}</span
    >
    <div class='flex-shrink-0 rounded-lg bg-white/5 p-2 transition-all duration-300 group-hover:bg-primary/10'>
      <Icon icon='chevron-down' class='h-4 w-4 text-muted transition-transform duration-300 group-hover:text-primary faq-chevron' />
    </div>
  </button>
  <div class:list={['answer transition-all duration-300', { hidden: !isActive }]} faq-answer>
    <slot />
  </div>
</div>

<script>
  document.querySelectorAll('[faq-question]').forEach((el) => {
    el.addEventListener('click', () => {
      const parent = el.closest('.faq-item');
      const answer = el.nextElementSibling;
      const chevron = el.querySelector('.faq-chevron');
      const isCurrentlyOpen = answer && !answer.classList.contains('hidden');

      // Hide all answers and reset chevrons
      document.querySelectorAll('[faq-answer]').forEach((element) => {
        element.classList.add('hidden');
      });
      document.querySelectorAll('.faq-chevron').forEach((icon) => {
        icon.style.transform = 'rotate(0deg)';
      });

      // If it wasn't open, open it
      if (!isCurrentlyOpen && answer && chevron) {
        answer.classList.remove('hidden');
        chevron.style.transform = 'rotate(180deg)';
      }
    });
  });

  // Set initial chevron state
  document.querySelectorAll('.faq-item').forEach((item) => {
    const answer = item.querySelector('[faq-answer]');
    const chevron = item.querySelector('.faq-chevron');
    if (answer && chevron && !answer.classList.contains('hidden')) {
      chevron.style.transform = 'rotate(180deg)';
    }
  });
</script>
