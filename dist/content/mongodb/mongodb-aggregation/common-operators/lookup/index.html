<!DOCTYPE html><link href=/_astro/_...topicId_.bad8bb91.css rel=stylesheet /><main class=prose-custom id=main-content><h1 id=lookup>$lookup</h1><p>The <code>$lookup</code> stage in MongoDB is a powerful aggregation pipeline operator that allows you to perform left outer join between two collections. It is used for combining data from multiple collections in a single aggregation pipeline operation.</p><p>Hereâ€™s a brief summary of <code>$lookup</code> operator:</p><h2 id=syntax>Syntax</h2><p>The <code>$lookup</code> operator uses the following syntax:</p><pre class="astro-code dracula" is:raw="" style=background-color:#282a36;overflow-x:auto tabindex=0><code><span class=line><span style=color:#f8f8f2>{</span></span>
<span class=line><span style=color:#f8f8f2>  </span><span style=color:#8be9fe>"</span><span style=color:#8be9fd>$lookup</span><span style=color:#8be9fe>"</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> {</span></span>
<span class=line><span style=color:#f8f8f2>    </span><span style=color:#8be9fe>"</span><span style=color:#8be9fd>from</span><span style=color:#8be9fe>"</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#e9f284>"</span><span style=color:#f1fa8c>&#x3C;collection_name></span><span style=color:#e9f284>"</span><span style=color:#f8f8f2>,</span></span>
<span class=line><span style=color:#f8f8f2>    </span><span style=color:#8be9fe>"</span><span style=color:#8be9fd>localField</span><span style=color:#8be9fe>"</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#e9f284>"</span><span style=color:#f1fa8c>&#x3C;field_from_input_documents></span><span style=color:#e9f284>"</span><span style=color:#f8f8f2>,</span></span>
<span class=line><span style=color:#f8f8f2>    </span><span style=color:#8be9fe>"</span><span style=color:#8be9fd>foreignField</span><span style=color:#8be9fe>"</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#e9f284>"</span><span style=color:#f1fa8c>&#x3C;field_from_documents_of_the_from_collection></span><span style=color:#e9f284>"</span><span style=color:#f8f8f2>,</span></span>
<span class=line><span style=color:#f8f8f2>    </span><span style=color:#8be9fe>"</span><span style=color:#8be9fd>as</span><span style=color:#8be9fe>"</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#e9f284>"</span><span style=color:#f1fa8c>&#x3C;output_array_field></span><span style=color:#e9f284>"</span></span>
<span class=line><span style=color:#f8f8f2>  }</span></span>
<span class=line><span style=color:#f8f8f2>}</span></span></code></pre><h2 id=parameters>Parameters</h2><ul><li><code>from</code>: The target collection to perform the join operation with.</li><li><code>localField</code>: The field from the input collection (i.e., the collection on which the <code>$lookup</code> is applied).</li><li><code>foreignField</code>: The field from the target collection (i.e., the <code>from</code> collection).</li><li><code>as</code>: The name of the output array field that will store the joined documents.</li></ul><h2 id=example>Example</h2><p>Suppose you have two collections, <code>orders</code> and <code>products</code>. The <code>orders</code> collection contains documents with following fields: <code>orderId</code>, <code>productId</code>, and <code>quantity</code>. The <code>products</code> collection contains documents with fields: <code>productId</code>, <code>productName</code>, and <code>price</code>.</p><p>To calculate the total amount of each order, you can use the <code>$lookup</code> operator along with other aggregation stages:</p><pre class="astro-code dracula" is:raw="" style=background-color:#282a36;overflow-x:auto tabindex=0><code><span class=line><span style=color:#f8f8f2>db.orders.</span><span style=color:#50fa7b>aggregate</span><span style=color:#f8f8f2>([</span></span>
<span class=line><span style=color:#f8f8f2>  {</span></span>
<span class=line><span style=color:#f8f8f2>    $lookup</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> {</span></span>
<span class=line><span style=color:#f8f8f2>      from</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#e9f284>'</span><span style=color:#f1fa8c>products</span><span style=color:#e9f284>'</span><span style=color:#f8f8f2>,</span></span>
<span class=line><span style=color:#f8f8f2>      localField</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#e9f284>'</span><span style=color:#f1fa8c>productId</span><span style=color:#e9f284>'</span><span style=color:#f8f8f2>,</span></span>
<span class=line><span style=color:#f8f8f2>      foreignField</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#e9f284>'</span><span style=color:#f1fa8c>productId</span><span style=color:#e9f284>'</span><span style=color:#f8f8f2>,</span></span>
<span class=line><span style=color:#f8f8f2>      as</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#e9f284>'</span><span style=color:#f1fa8c>productDetails</span><span style=color:#e9f284>'</span><span style=color:#f8f8f2>,</span></span>
<span class=line><span style=color:#f8f8f2>    },</span></span>
<span class=line><span style=color:#f8f8f2>  },</span></span>
<span class=line><span style=color:#f8f8f2>  {</span></span>
<span class=line><span style=color:#f8f8f2>    $unwind</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#e9f284>'</span><span style=color:#f1fa8c>$productDetails</span><span style=color:#e9f284>'</span><span style=color:#f8f8f2>,</span></span>
<span class=line><span style=color:#f8f8f2>  },</span></span>
<span class=line><span style=color:#f8f8f2>  {</span></span>
<span class=line><span style=color:#f8f8f2>    $project</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> {</span></span>
<span class=line><span style=color:#f8f8f2>      orderId</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> </span><span style=color:#bd93f9>1</span><span style=color:#f8f8f2>,</span></span>
<span class=line><span style=color:#f8f8f2>      totalAmount</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> {</span></span>
<span class=line><span style=color:#f8f8f2>        $multiply</span><span style=color:#ff79c6>:</span><span style=color:#f8f8f2> [</span><span style=color:#e9f284>'</span><span style=color:#f1fa8c>$quantity</span><span style=color:#e9f284>'</span><span style=color:#f8f8f2>, </span><span style=color:#e9f284>'</span><span style=color:#f1fa8c>$productDetails.price</span><span style=color:#e9f284>'</span><span style=color:#f8f8f2>],</span></span>
<span class=line><span style=color:#f8f8f2>      },</span></span>
<span class=line><span style=color:#f8f8f2>    },</span></span>
<span class=line><span style=color:#f8f8f2>  },</span></span>
<span class=line><span style=color:#f8f8f2>]);</span></span></code></pre><p>In this example, <code>$lookup</code> will join the <code>orders</code> and <code>products</code> collections based on <code>productId</code>. The joined data will be stored in the new <code>productDetails</code> array field. Additional aggregation stages (<code>$unwind</code> and <code>$project</code>) are used to calculate and display the total amount of each order.</p><p>So, the <code>$lookup</code> operator becomes an essential tool when you need to work with data from multiple collections and perform complex data processing tasks in MongoDB.</p></main>