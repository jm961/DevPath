import{d,y as b}from"./hooks.module.33a64516.js";import{S as I}from"./spinner.164b1eeb.js";import{g as u}from"./supabase.a03ca7bc.js";import{u as n}from"./jsxRuntime.module.9861337b.js";import{k as A}from"./preact.module.0dc3e805.js";import"./preload-helper.cf010ec4.js";const G="/_astro/google.7060ed7f.svg",i="googleRedirectAt",s="googleLastPage";function C(e){const[o,t]=d(!1),[r,a]=d(""),l=o?I:G;return b((()=>{const e=u();e?new URLSearchParams(window.location.hash.substring(1)).get("access_token")&&(t(!0),e.auth.getSession().then((({data:e,error:o})=>{if(o||!e.session)return a("Something went wrong. Please try again later."),void t(!1);let n="/";const r=localStorage.getItem(i),l=localStorage.getItem(s);if(r&&l){const e=parseInt(r,10);Date.now()-e<3e4&&(n=l)}localStorage.removeItem(i),localStorage.removeItem(s),window.history.replaceState({},document.title,window.location.pathname),window.location.href=n}))):console.error("Supabase not configured")}),[]),n(A,{children:[n("button",{class:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:o,onClick:async()=>{t(!0),a("");try{["/login","/signup"].includes(window.location.pathname)||(localStorage.setItem(i,Date.now().toString()),localStorage.setItem(s,window.location.pathname));const e=u();if(!e)return a("Authentication is not configured. Please contact the site owner."),void t(!1);const{data:o,error:n}=await e.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/login`}});n&&(console.error("Supabase OAuth error:",n),a("Something went wrong. Please try again later."),t(!1))}catch(e){console.error("OAuth error:",e),a("Something went wrong. Please try again later."),t(!1)}},children:[n("img",{src:l,alt:"Google",class:"h-[18px] w-[18px] "+(o?"animate-spin":"")}),"Continue with Google"]}),r&&n("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:r})]})}export{C as GoogleButton};