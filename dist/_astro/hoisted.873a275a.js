import"./hoisted.72d3f4fe.js";import{_ as l}from"./preload-helper.cf010ec4.js";import{g as a}from"./supabase.a03ca7bc.js";import"./popup.4f9d3eac.js";import"./jwt.2ecd63f4.js";l(()=>import("./renderer.4845021a.js"),["_astro/renderer.4845021a.js","_astro/jwt.2ecd63f4.js","_astro/hoisted.72d3f4fe.js","_astro/preload-helper.cf010ec4.js","_astro/supabase.a03ca7bc.js","_astro/popup.4f9d3eac.js"]).then(n=>{new n.Renderer().init()}).catch(n=>{console.error("❌ Failed to load renderer:",n)});class h{constructor(){this.init=this.init.bind(this),this.onScroll=this.onScroll.bind(this),this.shareIconsId="page-share-icons"}get shareIconsEl(){return document.getElementById(this.shareIconsId)}onScroll(){if(window.scrollY<100||window.innerWidth<1050)return this.shareIconsEl.classList.add("hidden"),null;this.shareIconsEl.classList.remove("hidden")}init(){this.shareIconsEl&&window.addEventListener("scroll",this.onScroll,{passive:!0})}}const p=new h;p.init();async function d({resourceId:n,resourceType:i,topicId:t}){const e=a();if(!e)throw new Error("Supabase not configured");const{data:{user:s}}=await e.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:o}=await e.from("user_progress").select("id").eq("user_id",s.id).eq("resource_type",i).eq("resource_id",n).eq("topic_id",t).single();return o?await e.from("user_progress").delete().eq("id",o.id):await e.from("user_progress").insert({user_id:s.id,resource_type:i,resource_id:n,topic_id:t}),{status:"ok"}}async function v({resourceId:n,resourceType:i}){const t=a();if(!t)return{done:[]};const{data:{user:e}}=await t.auth.getUser();if(!e)return{done:[]};const{data:s,error:o}=await t.from("user_progress").select("topic_id").eq("user_id",e.id).eq("resource_type",i).eq("resource_id",n);return o?(console.error("Error fetching progress:",o),{done:[]}):{done:s?.map(c=>c.topic_id)||[]}}class u{constructor(){this.overlayId="topic-overlay",this.contentId="topic-content",this.loaderId="topic-loader",this.topicBodyId="topic-body",this.topicActionsId="topic-actions",this.markTopicDoneId="mark-topic-done",this.markTopicPendingId="mark-topic-pending",this.closeTopicId="close-topic",this.contributionTextId="contrib-meta",this.activeResourceType=null,this.activeResourceId=null,this.activeTopicId=null,this.contentCache=new Map,this.handleRoadmapTopicClick=this.handleRoadmapTopicClick.bind(this),this.handleBestPracticeTopicClick=this.handleBestPracticeTopicClick.bind(this),this.handleBestPracticeTopicToggle=this.handleBestPracticeTopicToggle.bind(this),this.handleBestPracticeTopicPending=this.handleBestPracticeTopicPending.bind(this),this.close=this.close.bind(this),this.resetDOM=this.resetDOM.bind(this),this.populate=this.populate.bind(this),this.handleOverlayClick=this.handleOverlayClick.bind(this),this.markAsDone=this.markAsDone.bind(this),this.markAsPending=this.markAsPending.bind(this),this.querySvgElementsByTopicId=this.querySvgElementsByTopicId.bind(this),this.rightClickListener=this.rightClickListener.bind(this),this.isTopicDone=this.isTopicDone.bind(this),this.init=this.init.bind(this)}get loaderEl(){return document.getElementById(this.loaderId)}get markTopicDoneEl(){return document.getElementById(this.markTopicDoneId)}get markTopicPendingEl(){return document.getElementById(this.markTopicPendingId)}get topicActionsEl(){return document.getElementById(this.topicActionsId)}get contributionTextEl(){return document.getElementById(this.contributionTextId)}get contentEl(){return document.getElementById(this.contentId)}get overlayEl(){return document.getElementById(this.overlayId)}rightClickListener(i){const t=i.target?.closest("g")?.dataset?.groupId;t&&(i.preventDefault(),this.isTopicDone(t)?this.markAsPending(t,this.activeResourceId,this.activeResourceType):this.markAsDone(t,this.activeResourceId,this.activeResourceType))}resetDOM(i=!1){i?this.overlayEl.classList.add("hidden"):this.overlayEl.classList.remove("hidden"),this.loaderEl.classList.remove("hidden"),this.topicActionsEl.classList.add("hidden"),this.contributionTextEl.classList.add("hidden"),this.contentEl.replaceChildren("")}close(){this.resetDOM(!0),this.activeResourceId=null,this.activeTopicId=null}isTopicDone(i){const t=i.replace(/^\d+-/,"");return document.querySelector(`[data-group-id$="-${t}"]`)?.classList.contains("done")}populate(i){this.contentEl.replaceChildren(i),this.loaderEl.classList.add("hidden"),this.topicActionsEl.classList.remove("hidden"),this.contributionTextEl.classList.remove("hidden"),this.isTopicDone(this.activeTopicId)?(this.markTopicDoneEl.classList.add("hidden"),this.markTopicPendingEl.classList.remove("hidden")):(this.markTopicDoneEl.classList.remove("hidden"),this.markTopicPendingEl.classList.add("hidden"))}renderTopicFromUrl(i){const t=`/content${i}`;if(this.contentCache.has(t)){const e=this.contentCache.get(t);return this.populate(e.cloneNode(!0)),Promise.resolve()}return fetch(t).then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.text()}).then(e=>{const s=new DOMParser().parseFromString(e,"text/html"),o=s.getElementById("main-content")||s.body.firstElementChild;return o&&this.contentCache.size<50&&this.contentCache.set(t,o.cloneNode(!0)),o}).then(e=>{this.populate(e)}).catch(e=>{console.error("Error loading topic content:",e),this.populate("Error loading the content!")})}handleBestPracticeTopicToggle(i){const{resourceId:t,topicId:e}=i.detail;if(!e||!t)return;const s=e.replace(/^\d+-/,"");this.querySvgElementsByTopicId(s).some(r=>r?.classList?.contains("done"))?this.markAsPending(e,t,"best-practice"):this.markAsDone(e,t,"best-practice")}handleBestPracticeTopicPending(i){const{resourceId:t,topicId:e}=i.detail;!e||!t||this.markAsPending(e,t,"best-practice")}handleBestPracticeTopicClick(i){const{resourceId:t,topicId:e}=i.detail;if(!e||!t)return;this.activeResourceType="best-practice",this.activeResourceId=t,this.activeTopicId=e,this.resetDOM();const s=`/best-practices/${t}/${e.replaceAll(":","/")}`;this.renderTopicFromUrl(s).then(()=>null)}handleRoadmapTopicClick(i){const{resourceId:t,topicId:e}=i.detail;if(!e||!t)return;this.activeResourceType="roadmap",this.activeResourceId=t,this.activeTopicId=e,this.resetDOM();const s=`/${t}/${e.replaceAll(":","/")}`;window.fireEvent&&window.fireEvent({category:"RoadmapClick",action:`${t}/load-topic`,label:s}),this.renderTopicFromUrl(s).then(()=>null)}querySvgElementsByTopicId(i){const t=[];return document.querySelectorAll(`[data-group-id$="-${i}"]`).forEach(e=>{const s=e?.dataset?.groupId||"";new RegExp(`^\\d+-${i}$`).test(s)&&t.push(e)}),document.querySelectorAll(`[data-group-id="${i}"]`).forEach(e=>{t.push(e)}),document.querySelectorAll(`[data-group-id="check:${i}"]`).forEach(e=>{t.push(e)}),t}async markAsDone(i,t,e){const s=i.replace(/^\d+-/,""),{response:o,error:c}=await d({resourceId:t,topicId:s,resourceType:e});this.querySvgElementsByTopicId(s).forEach(r=>{r?.classList?.add("done")}),o?this.close():(console.warn("⚠️ Backend API failed, but UI updated locally:",c),localStorage.setItem(`progress-${e}-${t}-${s}`,"done"))}async markAsPending(i,t,e){const s=i.replace(/^\d+-/,""),{response:o,error:c}=await d({resourceId:t,topicId:s,resourceType:e});this.querySvgElementsByTopicId(s).forEach(r=>{r?.classList?.remove("done")}),o?this.close():(console.warn("⚠️ Backend API failed, but UI updated locally:",c),localStorage.removeItem(`progress-${e}-${t}-${s}`))}handleOverlayClick(i){if(!i.target.closest(`#${this.topicBodyId}`)){this.close();return}(i.target.id===this.markTopicDoneId||i.target.closest(`#${this.markTopicDoneId}`))&&this.markAsDone(this.activeTopicId,this.activeResourceId,this.activeResourceType),(i.target.id===this.markTopicPendingId||i.target.closest(`#${this.markTopicPendingId}`))&&this.markAsPending(this.activeTopicId,this.activeResourceId,this.activeResourceType);const o=i.target.dataset.popup||i.target.closest("button[data-popup]");(i.target.id===this.closeTopicId||i.target.closest(`#${this.closeTopicId}`)||o)&&this.close()}init(){window.addEventListener("best-practice.topic.click",this.handleBestPracticeTopicClick),window.addEventListener("best-practice.topic.toggle",this.handleBestPracticeTopicToggle),window.addEventListener("roadmap.topic.click",this.handleRoadmapTopicClick),window.addEventListener("click",this.handleOverlayClick),window.addEventListener("contextmenu",this.rightClickListener),window.addEventListener("keydown",i=>{i.key.toLowerCase()==="escape"&&this.close()})}}const g=new u;g.init();export{v as g};
