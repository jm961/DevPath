import"./jwt.2ecd63f4.js";import{g as b}from"./hoisted.94202571.js";import"./preload-helper.cf010ec4.js";import"./supabase.a03ca7bc.js";import"./hoisted.72d3f4fe.js";import"./popup.4f9d3eac.js";function x(t){return`rgb(${t>>16&255},${t>>8&255},${255&t})`}function f(t,e={},r){let o=document.createElementNS("http://www.w3.org/2000/svg",t);for(let t in e)e.hasOwnProperty(t)&&o.setAttribute(t,e[t]);return r&&r.appendChild(o),o}var y={black:["#000"],gray:["#000","#333","#666","#999","#ccc","#ddd","#eee"],white:["#fff"],red:["#cf2a27","#ea9999","#eo6666","#cc0000","#990000","#660000"],orange:["#ff9900","#f9cb9c","#f6b26b","#e69138","#b45f06","#783f04"],yellow:["#ffff00","#ffe599","#ffd966","#f1c232","#bf9000","#7f6000"],green:["#009e0f","#b6d7a8","#93c47d","#6aa84f","#38761d","#274e13"],cyan:["#00ffff","#a2c4c9","#76a5af","#45818e","#134f5c","#0c343d"],blue:["#2b78e4","#9fc5f8","#6fa8dc","#597eaa","#085394","#073763"],purple:["#9900ff","#b4a7d6","#8e7cc3","#674ea7","#351c75","#20124d"],pink:["#ff00ff","#d5a6bd","#c27ba0","#a64d79","#741b47","#4c1130"]},v=class{svgRoot;fontFamily;canvasRenderingContext2D;constructor(t,e){this.svgRoot=t,this.fontFamily=e,this.canvasRenderingContext2D=document.createElement("canvas").getContext("2d")}render(t,e){let r=t.typeID;r in this?this[r](t,e):console.log(`'${r}' control type not implemented`)}parseColor(t,e){return void 0===t?`rgb(${e})`:x(t)}parseFontProperties(t){return{style:t.properties?.italic?"italic":"normal",weight:t.properties?.bold?"bold":"normal",size:t.properties?.size?t.properties.size+"px":"13px",family:this.fontFamily}}measureText(t,e){return this.canvasRenderingContext2D.font=e,this.canvasRenderingContext2D.measureText(t)}drawRectangle(t,e){f("rect",{x:parseInt(t.x)+1.35,y:parseInt(t.y)+1.35,width:parseInt(t.w??t.measuredW)-2.7,height:parseInt(t.h??t.measuredH)-2.7,rx:2,fill:this.parseColor(t.properties?.color,"255,255,255"),"fill-opacity":t.properties?.backgroundAlpha??1,stroke:this.parseColor(t.properties?.borderColor,"0,0,0"),"stroke-width":2.7},e)}addText(t,e,r,o){let s=t.properties.text??"",n=parseInt(t.x),i=parseInt(t.y),a=this.parseFontProperties(t),c=this.measureText(s,`${a.style} ${a.weight} ${a.size} ${a.family}`),d=f("text",{x:"center"===o?n+(t.w??t.measuredW)/2-c.width/2:n,y:i+t.measuredH/2+c.actualBoundingBoxAscent/2,fill:r,"font-style":a.style,"font-weight":a.weight,"font-size":a.size},e);if(s.includes("{color:"))s.split(/{color:|{color}/).forEach((t=>{if(t.includes("}")){let[e,r]=t.split("}");if(!e.startsWith("#")){let t=parseInt(e.slice(-1));e=isNaN(t)?y[e][0]:y[e][t]}f("tspan",{fill:e},d).textContent=r}else{f("tspan",{},d).textContent=t}}));else{f("tspan",{},d).textContent=s}}TextArea(t,e){this.drawRectangle(t,e)}Canvas(t,e){this.drawRectangle(t,e)}Label(t,e){this.addText(t,e,this.parseColor(t.properties?.color,"0,0,0"),"left")}TextInput(t,e){this.drawRectangle(t,e),this.addText(t,e,this.parseColor(t.properties?.textColor,"0,0,0"),"center")}Arrow(t,e){let r,o=parseInt(t.x),s=parseInt(t.y),{p0:n,p1:i,p2:a}=t.properties;"dotted"===t.properties?.stroke?r="0.8 12":"dashed"===t.properties?.stroke&&(r="28 46");let c=(a.x-n.x)*i.x,d=(a.y-n.y)*i.x;f("path",{d:`M${o+n.x} ${s+n.y}Q${o+n.x+c+d*i.y*3.6} ${s+n.y+d+-c*i.y*3.6} ${o+a.x} ${s+a.y}`,fill:"none",stroke:this.parseColor(t.properties?.color,"0,0,0"),"stroke-width":4,"stroke-linecap":"round","stroke-linejoin":"round","stroke-dasharray":r},e)}Icon(t,e){let r=parseInt(t.x),o=parseInt(t.y),s=10;f("circle",{cx:r+s,cy:o+s,r:s,fill:this.parseColor(t.properties?.color,"0,0,0")},e),"check-circle"===t.properties.icon.ID&&f("path",{d:`M${r+4.5} ${o+s}L${r+8.5} ${o+s+4} ${r+15} ${o+s-2.5}`,fill:"none",stroke:"#fff","stroke-width":3.5,"stroke-linecap":"round","stroke-linejoin":"round"},e)}HRule(t,e){let r,o=parseInt(t.x),s=parseInt(t.y);"dotted"===t.properties?.stroke?r="0.8, 8":"dashed"===t.properties?.stroke&&(r="18, 30"),f("path",{d:`M${o} ${s}L${o+parseInt(t.w??t.measuredW)} ${s}`,fill:"none",stroke:this.parseColor(t.properties?.color,"0,0,0"),"stroke-width":2.7,"stroke-linecap":"round","stroke-linejoin":"round","stroke-dasharray":r},e)}__group__(t,e){let r=t?.properties?.controlName||"",o=f("g",{...r?{class:"clickable-group","data-group-id":r}:{}},e);t.children.controls.control.sort(((t,e)=>t.zOrder-e.zOrder)).forEach((e=>{e.x=parseInt(e.x,10)+parseInt(t.x,10),e.y=parseInt(e.y,10)+parseInt(t.y,10),this.render(e,o)}))}};async function k(t,e={}){if((e={padding:5,fontFamily:"balsamiq",fontURL:"https://fonts.gstatic.com/s/balsamiqsans/v3/P5sEzZiAbNrN8SB3lQQX7Pncwd4XIA.woff2",...e}).fontURL){let t=new FontFace(e.fontFamily,`url(${e.fontURL})`);await t.load(),document.fonts.add&&document.fonts.add(t)}let r=t.mockup,o=f("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:`${r.measuredW-r.mockupW-e.padding} ${r.measuredH-r.mockupH-e.padding} ${parseInt(r.mockupW)+2*e.padding} ${parseInt(r.mockupH)+2*e.padding}`,style:"font-family: balsamiq"}),s=new v(o,e.fontFamily);return r.controls.control.sort(((t,e)=>t.zOrder-e.zOrder)).forEach((t=>{s.render(t,o)})),o}class T{constructor(){this.resourceId="",this.resourceType="",this.jsonUrl="",this.containerId="resource-svg-wrap",this.init=this.init.bind(this),this.onDOMLoaded=this.onDOMLoaded.bind(this),this.jsonToSvg=this.jsonToSvg.bind(this),this.handleSvgClick=this.handleSvgClick.bind(this),this.prepareConfig=this.prepareConfig.bind(this),this.switchRoadmap=this.switchRoadmap.bind(this),this.enhanceSvgWithConnectors=this.enhanceSvgWithConnectors.bind(this),this.createCurvedPath=this.createCurvedPath.bind(this),this.resizeBoxesToFitContent=this.resizeBoxesToFitContent.bind(this),this.addGradientDefinitions=this.addGradientDefinitions.bind(this)}get containerEl(){return document.getElementById(this.containerId)}createCurvedPath(t,e,r,o){const s=r-t,n=o-e,i=Math.sqrt(s*s+n*n),a=Math.min(.4*i,100);let c,d,l,p;return Math.abs(s)>Math.abs(n)?(c=t+a,d=e,l=r-a,p=o):(c=t,d=e+a,l=r,p=o-a),`M ${t} ${e} C ${c} ${d}, ${l} ${p}, ${r} ${o}`}enhanceSvgWithConnectors(){const t=this.containerEl.querySelector("svg");if(!t)return;this.addGradientDefinitions(t);const e=t.querySelectorAll("line");t.querySelectorAll("path");let r=t.querySelector("#enhanced-connectors");if(r?r.innerHTML="":(r=document.createElementNS("http://www.w3.org/2000/svg","g"),r.id="enhanced-connectors",r.setAttribute("class","futuristic-connectors"),t.insertBefore(r,t.firstChild)),e.forEach(((t,e)=>{const o=parseFloat(t.getAttribute("x1")),s=parseFloat(t.getAttribute("y1")),n=parseFloat(t.getAttribute("x2")),i=parseFloat(t.getAttribute("y2"));if(isNaN(o)||isNaN(s)||isNaN(n)||isNaN(i))return;const a=this.createCurvedPath(o,s,n,i),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",a),c.setAttribute("class","connector-glow"),c.setAttribute("fill","none"),c.setAttribute("stroke","rgba(59, 130, 246, 0.15)"),c.setAttribute("stroke-width","6"),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.style.filter="blur(4px)",c.style.pointerEvents="none";const d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",a),d.setAttribute("class","connector-main"),d.setAttribute("fill","none"),d.setAttribute("stroke","rgba(59, 130, 246, 0.3)"),d.setAttribute("stroke-width","2"),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.style.pointerEvents="none";const l=d.getTotalLength?.()||0;l>0&&(d.style.strokeDasharray=`${l}`,d.style.strokeDashoffset=`${l}`,d.style.animation="drawConnector 2s ease-out forwards",d.style.animationDelay=.05*e+"s"),r.appendChild(c),r.appendChild(d),t.style.opacity="0"})),!document.getElementById("connector-animations")){const t=document.createElement("style");t.id="connector-animations",t.textContent="\n        @keyframes drawConnector {\n          to {\n            stroke-dashoffset: 0;\n          }\n        }\n        \n        .futuristic-connectors .connector-main:hover {\n          stroke: rgba(59, 130, 246, 0.6);\n          stroke-width: 3;\n        }\n        \n        .futuristic-connectors .connector-glow:hover {\n          stroke: rgba(59, 130, 246, 0.3);\n        }\n      ",document.head.appendChild(t)}}resizeBoxesToFitContent(t){t.querySelectorAll(".clickable-group").forEach((t=>{const e=t.querySelector("rect"),r=t.querySelector("text");if(!e||!r)return;const o=r.getBBox(),s=o.width+32,n=o.height+24,i=parseFloat(e.getAttribute("width")),a=parseFloat(e.getAttribute("height"));if(o.width>i-32||o.height>a-24){const t=Math.max(i,s),o=Math.max(a,n);e.setAttribute("width",t),e.setAttribute("height",o);const c=parseFloat(e.getAttribute("x")),d=parseFloat(e.getAttribute("y"));r.setAttribute("x",c+t/2),r.setAttribute("y",d+o/2)}}))}addGradientDefinitions(t){let e=t.querySelector("defs");if(e||(e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t.insertBefore(e,t.firstChild)),t.querySelector("#textGradient"))return;const r=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");r.id="textGradient",r.setAttribute("x1","0%"),r.setAttribute("y1","0%"),r.setAttribute("x2","100%"),r.setAttribute("y2","0%");const o=document.createElementNS("http://www.w3.org/2000/svg","stop");o.setAttribute("offset","0%"),o.setAttribute("style","stop-color:rgb(59,130,246);stop-opacity:1");const s=document.createElementNS("http://www.w3.org/2000/svg","stop");s.setAttribute("offset","100%"),s.setAttribute("style","stop-color:rgb(139,92,246);stop-opacity:1"),r.appendChild(o),r.appendChild(s),e.appendChild(r);const n=document.createElementNS("http://www.w3.org/2000/svg","filter");n.id="glow",n.setAttribute("x","-50%"),n.setAttribute("y","-50%"),n.setAttribute("width","200%"),n.setAttribute("height","200%");const i=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");i.setAttribute("stdDeviation","4"),i.setAttribute("result","coloredBlur");const a=document.createElementNS("http://www.w3.org/2000/svg","feMerge"),c=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");c.setAttribute("in","coloredBlur");const d=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");d.setAttribute("in","SourceGraphic"),a.appendChild(c),a.appendChild(d),n.appendChild(i),n.appendChild(a),e.appendChild(n)}prepareConfig(){if(!this.containerEl)return!1;const t=this.containerEl.dataset;return this.resourceType=t.resourceType,this.resourceId=t.resourceId,this.jsonUrl=t.jsonUrl,!0}async topicToggleDone(){const{response:t,error:e}=await b({resourceId:this.resourceId,resourceType:this.resourceType});if(!t)return void console.error(e);const{done:r}=t;r.forEach((t=>{const e=document.querySelector(`[data-group-id$="-${t}"]`);e&&e.classList.add("done")}))}jsonToSvg(t){return t?(this.containerEl.innerHTML="",Promise.all([fetch(t).then((t=>{if(!t.ok)throw new Error(`Failed to fetch: ${t.status} ${t.statusText}`);return t.json()})).then((t=>k(t,{fontURL:"/fonts/balsamiq.woff2"}))).then((t=>{this.containerEl.replaceChildren(t),setTimeout((()=>{this.enhanceSvgWithConnectors()}),100)})).catch((t=>{console.error("‚ùå Error rendering roadmap:",t);const e=`\n          <strong>There was an error loading the roadmap.</strong><br><br>\n          \n          <strong>Error:</strong> ${t.message}<br><br>\n          \n          <details style="text-align: left; max-width: 600px; margin: 1rem auto;">\n            <summary style="cursor: pointer; color: #ef4444; font-weight: 600;">Technical Details</summary>\n            <pre style="background: rgba(0,0,0,0.5); padding: 1rem; border-radius: 8px; overflow-x: auto; margin-top: 1rem;">${t.stack||t.message}</pre>\n          </details>\n          \n          <div style="margin-top: 1.5rem;">\n            <button onclick="window.location.reload()" style="background: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; border: none; cursor: pointer; font-weight: 600;">\n              Try Again\n            </button>\n          </div>\n        `;this.containerEl.innerHTML=`<div class="error" style="padding: 2rem; max-width: 800px; margin: 2rem auto;">${e}</div>`})),this.topicToggleDone()])):(console.error("jsonUrl not defined in frontmatter"),null)}onDOMLoaded(){if(!this.prepareConfig())return;const t=new URLSearchParams(window.location.search).get("r");t?this.switchRoadmap(`/jsons/roadmaps/${t}.json`):this.jsonToSvg(this.jsonUrl)}switchRoadmap(t){const e=t.split("/").pop().replace(".json","");if(window?.history?.pushState){const t=new URL(window.location),r=this.resourceType[0];t.searchParams.delete(r),t.searchParams.set(r,e),window.history.pushState(null,"",t.toString())}const r=this.resourceType.replace(/\b\w/g,(t=>t.toUpperCase()));window.fireEvent&&window.fireEvent({category:`${r.replace("-","")}Click`,action:`${this.resourceId}/switch-version`,label:`${e}`}),this.jsonToSvg(t).then((()=>{this.containerEl.setAttribute("style",""),setTimeout((()=>{this.enhanceSvgWithConnectors()}),100)}))}handleSvgClick(t){if(!this.containerEl||!this.containerEl.contains(t.target))return;const e=t.target.closest("g")||{},r=e.dataset?e.dataset.groupId:"";if(!r)return;if(t.stopImmediatePropagation(),/^ext_link/.test(r))return void window.open(`https://${r.replace("ext_link:","")}`);if(/^json:/.test(r)){const t=r.replace("json:","");return void this.switchRoadmap(t)}if(/^check:/.test(r))return void window.dispatchEvent(new CustomEvent(`${this.resourceType}.topic.toggle`,{detail:{topicId:r.replace("check:",""),resourceType:this.resourceType,resourceId:this.resourceId}}));const o=r.replace(/^\d+-/,"");window.dispatchEvent(new CustomEvent(`${this.resourceType}.topic.click`,{detail:{topicId:o,resourceId:this.resourceId,resourceType:this.resourceType}}))}handleSvgHover(t){const e=t.target.closest("g")||{},r=e.dataset?e.dataset.groupId:"";if(!r||/^ext_link|^json:|^check:/.test(r))return;const o=r.replace(/^\d+-/,""),s=`/content/${this.resourceId}/${o.replaceAll(":","/")}`;this.prefetchedUrls||(this.prefetchedUrls=new Set),this.prefetchedUrls.has(s)||(this.prefetchedUrls.add(s),fetch(s,{priority:"low"}).catch((()=>{})))}init(){"loading"===document.readyState?window.addEventListener("DOMContentLoaded",this.onDOMLoaded):this.onDOMLoaded(),this.containerEl&&(this.containerEl.addEventListener("click",this.handleSvgClick),this.containerEl.addEventListener("mouseover",this.handleSvgHover.bind(this)))}}export{T as Renderer};