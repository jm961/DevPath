import{d,y as b}from"./hooks.module.33a64516.js";import{S}from"./spinner.164b1eeb.js";import{a as I,T as G}from"./jwt.2ecd63f4.js";import{u as i}from"./jsxRuntime.module.9861337b.js";import{k as P}from"./preact.module.0dc3e805.js";const T="/_astro/github.43963666.svg",a="githubRedirectAt",h="githubLastPage";function C(k){const[r,t]=d(!1),[s,n]=d(""),m=r?S:T;return b(()=>{const e=new URLSearchParams(window.location.search),u=e.get("code"),f=e.get("state"),p=e.get("provider");!u||!f||p!=="github"||(t(!0),fetch(`https://api.devpath.sh/api/v1-github-callback${window.location.search}`,{method:"GET",credentials:"include"}).then(o=>o.json()).then(o=>{if(!o.token)n("Something went wrong. Please try again later."),t(!1);else{let c="/";const l=localStorage.getItem(a),g=localStorage.getItem(h);if(l&&g){const w=parseInt(l,10);Date.now()-w<30*1e3&&(c=g)}localStorage.removeItem(a),I.set(G,o.token),window.location.href=c}}).catch(o=>{n("Something went wrong. Please try again later."),t(!1)}))},[]),i(P,{children:[i("button",{class:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:r,onClick:()=>{t(!0),fetch("https://api.devpath.sh/api/v1-github-login",{credentials:"include",redirect:"follow"}).then(e=>e.json()).then(e=>{e.loginUrl?(["/login","/signup"].includes(window.location.pathname)||(localStorage.setItem(a,Date.now().toString()),localStorage.setItem(h,window.location.pathname)),window.location.href=e.loginUrl):(n("Something went wrong. Please try again later."),t(!1))}).catch(e=>{n("Something went wrong. Please try again later."),t(!1)})},children:[i("img",{src:m,alt:"GitHub",class:`h-[18px] w-[18px] ${r?"animate-spin":""}`}),"Continue with GitHub"]}),s&&i("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:s})]})}export{C as GitHubButton};
